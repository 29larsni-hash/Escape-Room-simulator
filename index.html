<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <title>Simple VR Escape Room</title>
</head>
<body>
    <a-scene vr-mode-ui="enabled: true" background="color: #001122">
        <!-- Room -->
        <a-box position="0 0 0" width="6" height="4" depth="6" 
               material="color: #8B4513; side: back"></a-box>
        <a-plane position="0 -2 0" width="6" height="6" rotation="-90 0 0" 
                 color="#654321"></a-plane>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="point" position="0 1.5 0" color="#FFF"></a-light>
        
        <!-- VR Puzzle Elements -->
        
        <!-- 1. Color Button -->
        <a-cylinder id="color-button" position="-2 0 -2.8" radius="0.3" height="0.2" 
                   color="#FF0000" class="interactive" data-state="0">
        </a-cylinder>
        <a-text position="-2 1 -2.5" value="Touch to change color" align="center" color="#FFF"></a-text>
        
        <!-- 2. Collectible Key -->
        <a-torus id="vr-key" position="2 0.5 2" radius="0.2" radius-tubular="0.05" 
                color="#FFD700" class="interactive"
                animation="property: rotation; to: 0 360 0; dur: 3000; repeat: indefinite">
        </a-torus>
        <a-text position="2 1.2 2" value="Golden Key" align="center" color="#FFD700"></a-text>
        
        <!-- 3. Lever -->
        <a-box id="vr-lever" position="0 0 -2.8" width="0.1" height="0.8" depth="0.1" 
               color="#8B4513" class="interactive" data-state="down">
        </a-box>
        <a-text position="0 1.2 -2.5" value="Pull lever up" align="center" color="#FFF"></a-text>
        
        <!-- Exit Door -->
        <a-box id="vr-door" position="2.8 0 0" width="0.4" height="2" depth="1.5" 
               color="#654321" class="interactive">
        </a-box>
        <a-text id="door-text" position="2.5 1.5 0" value="LOCKED" align="center" color="#FF0000"></a-text>
        
        <!-- VR Camera Setup -->
        <a-entity id="cameraRig" position="0 0 0">
            <a-camera position="0 1.6 2.5" look-controls wasd-controls>
                <a-cursor color="#FFF" raycaster="objects: .interactive"></a-cursor>
            </a-camera>
            
            <!-- VR Hand Controllers -->
            <a-entity id="leftHand" 
                      hand-controls="hand: left"
                      raycaster="objects: .interactive"
                      line="start: 0, 0, 0; end: 0 0 -3; color: blue; opacity: 0.5">
            </a-entity>
            
            <a-entity id="rightHand" 
                      hand-controls="hand: right"
                      raycaster="objects: .interactive"
                      line="start: 0, 0, 0; end: 0 0 -3; color: red; opacity: 0.5">
            </a-entity>
        </a-entity>
        
        <!-- Status Display -->
        <a-text id="status" position="0 2.5 -2.8" value="Solve 3 puzzles to escape!" 
                align="center" color="#FFF"></a-text>
    </a-scene>

    <script>
        const gameState = {
            colorSolved: false,
            hasKey: false,
            leverUp: false
        };

        const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFD700']; // Red, Green, Blue, Gold

        document.addEventListener('DOMContentLoaded', function() {
            // Setup click events for VR and desktop
            setupInteractions();
        });

        function setupInteractions() {
            const interactives = document.querySelectorAll('.interactive');
            
            interactives.forEach(element => {
                // Works for both VR controllers and mouse clicks
                element.addEventListener('click', handleInteraction);
                element.addEventListener('triggerdown', handleInteraction);
                
                // Visual feedback on hover (works in VR too)
                element.addEventListener('mouseenter', function() {
                    element.setAttribute('scale', '1.1 1.1 1.1');
                });
                
                element.addEventListener('mouseleave', function() {
                    element.setAttribute('scale', '1 1 1');
                });
            });
        }

        function handleInteraction(event) {
            const element = event.target;
            
            switch(element.id) {
                case 'color-button':
                    cycleColor(element);
                    break;
                case 'vr-key':
                    collectKey(element);
                    break;
                case 'vr-lever':
                    toggleLever(element);
                    break;
                case 'vr-door':
                    checkDoor();
                    break;
            }
            
            updateStatus();
        }

        function cycleColor(button) {
            let state = parseInt(button.getAttribute('data-state') || '0');
            state = (state + 1) % colors.length;
            
            button.setAttribute('color', colors[state]);
            button.setAttribute('data-state', state.toString());
            
            // Puzzle solved when gold (index 3)
            gameState.colorSolved = (state === 3);
            
            if (gameState.colorSolved) {
                updateStatus('Color puzzle solved!');
            }
        }

        function collectKey(key) {
            if (!gameState.hasKey) {
                key.setAttribute('animation', 'property: scale; to: 0 0 0; dur: 500');
                gameState.hasKey = true;
                updateStatus('Key collected!');
                
                setTimeout(() => key.remove(), 500);
            }
        }

        function toggleLever(lever) {
            const state = lever.getAttribute('data-state');
            
            if (state === 'down') {
                lever.setAttribute('rotation', '45 0 0');
                lever.setAttribute('data-state', 'up');
                gameState.leverUp = true;
                updateStatus('Lever pulled up!');
            } else {
                lever.setAttribute('rotation', '0 0 0');
                lever.setAttribute('data-state', 'down');
                gameState.leverUp = false;
            }
        }

        function checkDoor() {
            if (gameState.colorSolved && gameState.hasKey && gameState.leverUp) {
                // All puzzles solved!
                const door = document.getElementById('vr-door');
                const doorText = document.getElementById('door-text');
                
                door.setAttribute('animation', 'property: rotation; to: 0 90 0; dur: 1000');
                door.setAttribute('color', '#00FF00');
                doorText.setAttribute('value', 'ESCAPED!');
                doorText.setAttribute('color', '#00FF00');
                
                updateStatus('ðŸŽ‰ YOU ESCAPED! ðŸŽ‰');
            } else {
                let needed = [];
                if (!gameState.colorSolved) needed.push('Color Puzzle');
                if (!gameState.hasKey) needed.push('Golden Key');
                if (!gameState.leverUp) needed.push('Pull Lever');
                
                updateStatus(`Still need: ${needed.join(', ')}`);
            }
        }

        function updateStatus(message) {
            const status = document.getElementById('status');
            if (message) {
                status.setAttribute('value', message);
            } else {
                const solved = Object.values(gameState).filter(Boolean).length;
                status.setAttribute('value', `Progress: ${solved}/3 puzzles solved`);
            }
        }
    </script>
</body>
</html>
